public class ClosureStability
{
	static double TOLERANCE
	
	int	number
	
	incrementNumber()
	{
		number++
	}
	
	public static test(StabilityTest program)
	{
		TOLERANCE = 0.0000000001
		
		testClosures(program)
	}
	
	static testClosures(StabilityTest program)
	{
		Console.writeLine("Testing closures...")
		
		testMathClosures(program)
		testInstanceClosure(program)
	}
	
	static testMathClosures(StabilityTest program)
	{
		Console.write("Testing static math closures... ")
		
		int a = 5
		int b = 3
		
		double value = 0.5
		
		if (callClosure(multiply, a, b) != multiply(a, b))
			program.fail("Failed to call multiply(int, int) closure")
			
		if (callClosure(pow, a, b) != pow(a, b))
			program.fail("Failed to call pow(int, int) closure")
			
		if (mathClosure(Math.sin, value) - Math.sin(value) >= TOLERANCE)
			program.fail("Failed to call Math.sin(double) closure")
			
		if (mathClosure(Math.tan, value) - Math.tan(value) >= TOLERANCE)
			program.fail("Failed to call Math.tan(double) closure")
		
		Console.writeLine("OK")
	}
	
	static testInstanceClosure(StabilityTest program)
	{
		Console.write("Testing instance closures... ")
		
		ClosureStability c = new ClosureStability()
		
		instanceClosure(c.incrementNumber)
		
		if (c.number == 0)
		{
			program.fail("Failed to call incrementNumber() instance closure")
		}
		
		instanceClosure(new ClosureStability().incrementNumber)
		instanceClosure(c.incrementNumber)
		
		Console.writeLine("OK")
	}
	
	static callClosure(int closure(int, int), int a, int b) -> int
	{
		return closure(a, b)
	}
	
	static mathClosure(double closure(double), double value) -> double
	{
		return closure(value)
	}
	
	static instanceClosure(void closure())
	{
		closure()
	}
	
	static multiply(int value1, int value2) -> int
	{
		return value1 * value2
	}
	
	static pow(int base, int pow) -> int
	{
		int value = base
		
		for (int i = 0; i < pow - 1; i++)
		{
			value = value * base
		}
		
		return value
	}
}