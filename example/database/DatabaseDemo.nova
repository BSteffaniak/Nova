package "example/database"

import "nova/standard/database/DBConnector"
import "nova/standard/database/ResultSet"

public class DatabaseDemo
{
	public static main(String args[])
	{
		DBConnector connection = connect()
		
		ResultSet result = connection.query("select * from market")
		
		for (Int row = 0; row < result.numRows; row++)
		{
			Console.write("Found (" + row + "): " + result.rows[row][0])
			
			for (Int col = 1; col < result.numCols; col++)
			{
				Console.write(", " + result.rows[row][col])
			}
			
			Console.writeLine("")
		}
		
		Int id = Int.parseInt(result.rows[result.numRows - 1][0]) + 1
		
		connection.query("insert into market values(" + id + ", 6, 634, 3);")
		
		close(connection)
		
		Console.waitForEnter()
	}
	
	static connect() -> DBConnector
	{
		Console.writeLine("Connecting...")
		
		DBConnector connection = new DBConnector()
		
		connection.connect("localhost", "root", "server", "test")
		
		String error = connection.error
		
		if (error.count > 0)
		{
			Console.writeLine("Error: " + error)
		}
		else
		{
			Console.writeLine("Connected.")
		}
		
		return connection
	}
	
	static close(DBConnector connection)
	{
		Console.writeLine("Closing...")
		connection.close()
		Console.writeLine("Closed")
	}
}